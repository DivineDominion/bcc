language: c

env:
  global:
    - LC_CTYPE=en_US.UTF-8
    - LANG=en_US.UTF-8

matrix:
  include:
    - os: osx
      osx_image: xcode10.2
      env: PLATFORM="macos" CPU="x64" STABLE="https://github.com/bmx-ng/bmx-ng/releases/download/v0.99.3.31.macos/BlitzMax_macos_0.99.3.31.zip"

install:
  - wget "${STABLE}"
  - unzip "`basename "${STABLE}"`"

script:
  - mkdir -p "build"
  - ./BlitzMax/bin/bmk
    makeapp -a -r
    -l ${PLATFORM}
    -g ${CPU}
    -o ./build/bcc
    ./bcc.bmx

before_deploy:
  - cd ./build
  - BCC_VERSION=`./bcc -v | sed 's/^.*\([0-9][0-9]*\.[0-9][0-9]*\).*/\1/'`
  - ZIP_FILENAME="bcc-v${BCC_VERSION}-${PLATFORM}-${CPU}.zip"
  - echo "Zipping $ZIP_FILENAME"
  - zip "$ZIP_FILENAME" bcc
  - ls -la

deploy:
  provider: releases
  file_glob: true
  file: build/*.zip
  skip_cleanup: true
  draft: true
  api_key:
    secure: GhssmFHbe9Y+aLmhI6bwFmVmTnaZ+WQz4gM3UuxQJUi1Oww2fBF/KhVly5X8YXI9/Bgd0AP9Ufr/VuJJSzSxmZZITmvrmEHt349OUSdHYdLS9+bJIdN16wFPlo+WCePLNYCEVxYCeyQbnSSn3t8PRD+d/tJcR16VzLr9S8XNuk1xMLBoXdAvpxe78obM6XUzyDS5/XlgWYGJYw73+VInmiliWrC+UQ7RYY0jBMzS7efjEszR70UCa5P/jQ8ar6DeJmLdWXmbhjLnu/YC9jyo28aMOB4Mhyfx3H1vv7PRynbUJRnouEw8Fj3u/+l6BYznM79amV+avWohXTO4VP0db+WdRI/C25nOTVDMl0NIPXJH7gyEUlvqmgaKEJQ0OyIyUmzQZFWU9P8Ze76g+vgPGPeatKMkdVCwTIXXutcFr1d2+sXMbw/ZNwpWcb3ImOXbQpY9uuUTZBEj4s8ykhHWtzsed3SlhLhW0rfkH7bqgvajEasaO1XoOL33fboDicO1Q7i+4aRJXQ3dq/eBgEUfW08tF62RjgSVMoWoJW2IQ2upSbOM3NP/7sMu44/Yg9jciuV2b/WcN5HYc4cUGFtV/pAw0hnG21PXFaucwPsTs9EYstGNc/GvB3aFujmNxjyxmD2XaYuFOTG3Wrj/yub/X0+WklAoMDj8xZi65vz/rs8=
  on:
    repo: DivineDominion/bcc
    all_branches: true
    condition: '"$TRAVIS_BRANCH" =~ ^release && "$TRAVIS_TAG" =~ ^v[0-9]'
    tags: true
